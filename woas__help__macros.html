<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta woas_permanent="1" http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>WoaS::Help::Macros</title><link rel="stylesheet" type="text/css" media="all" href="woas.css" /><meta name="generator" content="Wiki on a Stick v0.12.0 - http://stickwiki.sf.net/" />
<meta name="keywords" content="macro,text,my,macros,block,true,will,woas,name,can,color,note,parser,if,return,above,before,passed,newline,false,should,then,elements,strong,says,span,defined,using,default,WoaS,line,simple,any,parse,function,character,removed,value,sum,total,result,arg,wiki,syntax,macroA,brackets,create,also,like" />
<meta name="description" content="Wiki on a Stick (version 0.10.7 and above) supports wiki macros for pluggable wiki syntax. Using a defined macroA macro block is enclosed in triple angle brackets. This example will create an info box using one of the built-in default macros, woas.no" />
<meta name="author" content="ZeekLTK" />
</head><body class="woas_export"><div id="woas_header_wrap"><div id="woas_header"><span id="woas_title">WoaS::Help::Macros</span></div></div><div id="woas_content"><div id="woas_menu_wrap"><div id="woas_menu_pad"><div id="woas_menu"><a class="woas_link" title="" href="index.html">Main Page</a><ul><li><a class="woas_link" title="" href="timeline.html">Timeline</a></li><li><a class="woas_link" title="" href="zeekltk.html">ZeekLTK</a></li></ul><a class="woas_link" title="" href="challenge_league_season_2.html">Challenge League Season 2</a><br /><a class="woas_link" title="" href="fixtures.html">Fixtures</a><br /><ul><li><strong><a class="woas_link" title="" href="world_cup.html">World Cup</a></strong></li></ul><ul><li><strong><a class="woas_link" title="" href="challenge_league.html">Challenge League</a></strong></li></ul><ul><li><strong>Other Competitions</strong><ul><li><a class="woas_link" title="" href="confederations_cup.html">Confederations Cup</a></li><li><a class="woas_link" title="" href="euro_cup.html">Euro Cup</a></li><li><a class="woas_link" title="" href="african_cup.html">African Cup</a></li><li><a class="woas_link" title="" href="asian_cup.html">Asian Cup</a></li><li><a class="woas_link" title="" href="copa_america.html">Copa America</a></li><li><a class="woas_link" title="" href="gold_cup.html">Gold Cup</a></li><li><a class="woas_link" title="" href="world_series.html">World Series</a></li><li><a class="woas_link" title="" href="tens.html">Tens</a></li></ul></li></ul><ul><li><strong><span style="text-decoration:underline;">Teams</span></strong><ul><li><a class="woas_link" title="" href="afc.html">AFC</a></li><li><a class="woas_link" title="" href="caf.html">CAF</a></li><li><a class="woas_link" title="" href="concacaf.html">CONCACAF</a></li><li><a class="woas_link" title="" href="conmebol.html">CONMEBOL</a></li><li><a class="woas_link" title="" href="uefa.html">UEFA</a></li></ul></li></ul><ul><li><span class="woas_broken_link">Globe Cup</span></li><li><a class="woas_link" title="" href="international_league.html">International League</a></li><li><a class="woas_link" title="" href="development_cup.html">Development Cup</a></li></ul><ul><li><a class="woas_link" title="" href="records.html">Records</a></li></ul><ul><li><a class="woas_link" title="" href="world_rankings.html">World Rankings</a></li></ul><br /><input style="font-size:.75em;" id="menu_string_to_search" type="text" size="19" onkeydown="return menu_key_hook(event)" onfocus="menu_search_focus(true)" onblur="menu_search_focus(false)" />&nbsp;<input style="font-size:.75em;" class="woas_button" type="button" value="Search" onclick="menu_do_search()" /><br /><br /></div></div></div><div id="woas_page_wrap"><div id="woas_page">Wiki on a Stick (version 0.10.7 and above) supports wiki macros for pluggable wiki syntax.<br /><h2 class="woas_heading" id="S21951">Using a defined macro</h2>A macro block is enclosed in triple angle brackets. This example will create an info box using one of the built-in default macros, <em>woas.note</em>:<br /><pre class="woas_nowiki_multiline">&lt;&lt;&lt;woas.note: *This* is /my/ note&gt;&gt;&gt;</pre>This could also have been written like this:<br /><pre class="woas_nowiki_multiline">&lt;&lt;&lt;woas.note:
*This* is /my/ note
&gt;&gt;&gt;</pre>with exactly the same results. And here it is in action:<br /><div><div class='woas_note'>NOTE: <strong>This</strong> is <em>my</em> note</div></div><h2 class="woas_heading" id="S10726">Default macros</h2>These macros are currently defined by WoaS:<ul><li><em>woas.include</em> - allows a template page to be <a class="woas_link" title="WoaS::Help::Template transclusion" href="woas__help__template_transclusion.html">transcluded</a> with each new line of text in the macro block forming a transclusion parameter; this allows parameters to be used that would not be possible within a simple link;</li><li><em>woas.note</em> - as demonstrated above.</li></ul><h2 class="woas_heading" id="S12821">Defining a macro</h2>A macro is defined by using the special '%' sign before the macro name. Macro code is passed the macro object which has four standard properties:<ul><li><strong>block</strong> - set to true when the macro doesn't want any newline following it turned into a <tt class="woas_nowiki">&lt;br /&gt;</tt> tag (default false);</li><li><strong>parse</strong> - a simple parser function that can be used to parse text before returning it to the parser (e.g. <tt class="woas_nowiki">macro.text = macro.parse(macro.text)</tt>), instead of using <tt class="woas_nowiki">reprocess = true</tt>; this may speed up results in certain circumstances as it does not look for <a class="woas_link" title="WoaS::Help::Include wiki page" href="woas__help__include_wiki_page.html">transclude links</a> (<tt class="woas_nowiki">[[Include::...]]</tt>) or macros, and can make certain advanced macros possible (e.g. creating block markup, like headings, inside a list or table);</li><li><strong>reprocess</strong> - set to true when the returned text should be re-processed by the parser (default false);</li><li><strong>text</strong> - the content of the macro block after the colon. Exactly what text is passed to the macro follows some simple rules:<ul><li>if there is a newline character before the actual text then it and any other whitespace before the newline will be removed;</li><li>a single whitespace character between the colon and the text will be removed;</li><li>if the closing macro block brackets are on a line by themselves then the last newline character will also be removed from the text block;</li><li>the above rules can help readability and make the macro block act in a manner consistent with the <a class="woas_link" title="WoaS::Help::Nowiki text#Multi-line blocks" href="woas__help__nowiki_text.html#S15128">nowiki multi-line</a> syntax.</li></ul></li></ul>Existing macros cannot be replaced by a new macro definition. The macro should return a value of <tt class="woas_nowiki">true</tt> to show that it completed successfully; the parser will highlight the text of a macro that returns <tt class="woas_nowiki">false</tt>, and the debug log will include a warning if no value was returned.<br /><br />Let's define the <em>sum</em> macro:<br /><pre class="woas_nowiki_multiline">&lt;&lt;&lt;%my_sum:
  var elements = macro.text.split(/[\s\n]+/), total = 0;
  for (var i=0,l=elements.length;i&lt;l;++i) {
    if (!elements[i].length) continue;
    try { total += parseInt(elements[i]); } catch(e) { }
  }
  macro.text = total.toString();
  return true;
&gt;&gt;&gt;</pre>Now we call the macro:<br /><pre class="woas_nowiki_multiline">&lt;&lt;&lt;my_sum:
24
56
89
28
19
33
&gt;&gt;&gt;</pre>And this is the result: 249<br /><h2 class="woas_heading" id="S23848">Macros with arguments</h2>Starting with WoaS 0.12.0 macros support named arguments and should return a true/false value to tell about their success/failure at rendering the macro text.<br /><br />Example:<br /><pre class="woas_nowiki_multiline">&lt;&lt;&lt;%my_arg_macro(name, color):
    macro.text = "&lt;strong&gt;" + name +
	    "&lt;/strong&gt; says: &lt;span style=\"color: " +
	    color + "\"&gt;" + macro.text + "&lt;/span&gt;";
    return true;
&gt;&gt;&gt;</pre>Which is then called with:<br /><pre class="woas_nowiki_multiline">&lt;&lt;&lt;my_arg_macro("Simon", "green"):
I have 3 pieces of fruit in my basket
&gt;&gt;&gt;</pre>And the result is:<br /><br /><strong>Simon</strong> says: <span style="color: green">I have 3 pieces of fruit in my basket</span><br /><br />The passed arguments must be valid Javascript expressions.<br /><h2 class="woas_heading" id="S9185">Global macros</h2>Macros can be available on all pages if they are registered by plugins.<br /><br />In order to define a global macro you should create or edit a <a class="woas_link" title="WoaS::Help::Plugins" href="woas__help__plugins.html">plugin</a> and then add Javascript code similar to this:<br /><pre class="woas_nowiki_multiline">woas.macro.register('my.arg_macro', function(macro, name, color) {
macro.text = "&lt;strong&gt;"+name+"&lt;/strong&gt; says: &lt;span style=\"color: " +
    color + "\"&gt;" + macro.text + "&lt;/span&gt;";
return true;
});</pre><div><div class='woas_note'>NOTE: The first parameter to the macro function is the <em>macro</em> object that will be passed in by the parser: it doesn't appear in the macro call itself; it can, of course, have any name you want.</div></div>If the above macro was included in a page as <tt class="woas_nowiki">&lt;&lt;&lt;my.argMacro("Paul", "red"): Hi!&gt;&gt;&gt;</tt> the result would be:<br /><br /><strong>Paul</strong> says: <span style="color: red">Hi!</span><br /><br />You can learn more about macros by studying the macros and plugins that come with WoaS.</div></div></div></body></html>
